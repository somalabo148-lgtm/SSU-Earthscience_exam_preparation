<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>聞き取り第6回：Sediments and Coasts</title>
    <style>
        body {
            font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif;
            background-color: #f4f4f9;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        .video-info {
            text-align: center;
            margin-bottom: 30px;
            padding: 15px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .video-link {
            color: #e74c3c;
            font-weight: bold;
            text-decoration: none;
            font-size: 1.2em;
        }
        .video-link:hover {
            text-decoration: underline;
        }
        .question-card {
            background: #fff;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .q-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        .q-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #2980b9;
        }
        .play-link-btn {
            background-color: #e74c3c;
            color: white;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 4px;
            font-size: 0.9em;
            display: inline-block;
            transition: background-color 0.2s;
        }
        .play-link-btn:hover {
            background-color: #c0392b;
        }
        .theme-text {
            font-size: 0.95em;
            color: #555;
            margin-bottom: 15px;
            background: #f0f8ff;
            padding: 10px;
            border-left: 4px solid #3498db;
        }
        textarea {
            width: 100%;
            height: 80px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 1em;
            box-sizing: border-box;
            resize: vertical;
            font-family: inherit;
        }
        .controls {
            margin-top: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .check-btn {
            background-color: #27ae60;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1em;
        }
        .check-btn:hover {
            background-color: #219150;
        }
        .result-area {
            margin-top: 15px;
            padding: 15px;
            border: 1px solid #ddd;
            background-color: #fafafa;
            border-radius: 4px;
            display: none;
            line-height: 1.6;
        }
        .diff-word {
            margin: 0 2px;
            padding: 2px 0;
            display: inline-block;
        }
        .correct-word {
            color: #27ae60;
            font-weight: bold;
        }
        .wrong-word {
            color: #c0392b;
            text-decoration: line-through;
            margin-right: 4px;
        }
        .missing-word {
            color: #2980b9;
            font-weight: bold;
            border-bottom: 2px solid #2980b9;
        }
        .perfect {
            color: #27ae60;
            font-weight: bold;
            font-size: 1.2em;
        }
        .translation-toggle {
            font-size: 0.85em;
            color: #7f8c8d;
            cursor: pointer;
            text-decoration: underline;
        }
        .japanese-trans {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px dashed #eee;
            font-size: 0.9em;
            color: #555;
            display: none;
        }
    </style>
</head>
<body>

    <h1>聞き取り第6回：Sediments and Coasts</h1>
    
    <div class="video-info">
        対象動画URL: 
        <a href="https://www.youtube.com/watch?v=mUuGCVDfYEU" target="_blank" class="video-link">
            https://www.youtube.com/watch?v=mUuGCVDfYEU
        </a>
        <br>
        <span style="font-size:0.9em; color:#666; display:block; margin-top:5px;">
            ※ 各問題の「YouTubeで再生」ボタンを押すと、別タブで該当箇所から再生されます。
        </span>
    </div>

    <div id="quiz-container">
        </div>

    <script>
        // 動画IDとベースURL
        const BASE_URL = "https://youtu.be/mUuGCVDfYEU";

        // データ定義
        const quizData = [
            {
                id: 1,
                timeDisplay: "00:10 ～ 00:18",
                startSeconds: 10,
                theme: "動画の導入部分（川から海へ運ばれた堆積物との相互作用）について",
                correct: "We are now ready to look at how these interact with the sediments which are being transported by the rivers to the sea.",
                translation: "これで、川によって海へと運ばれてくる堆積物と、これらがどのように相互作用するのかを見ていく準備が整いました。"
            },
            {
                id: 2,
                timeDisplay: "00:56 ～ 01:04",
                startSeconds: 56,
                theme: "潮汐によって覆われる（または露出する）領域の幅を決める要因について",
                correct: "The width of the area covered and uncovered during tides is a function of the height of the tide and the steepness of the coast.",
                translation: "潮汐の間に水没したり現れたりする領域の幅は、潮位の高さと海岸の勾配によって決まります。"
            },
            {
                id: 3,
                timeDisplay: "01:57 ～ 02:07",
                startSeconds: 117, // 1分57秒
                theme: "潮汐の流路が狭くなることによる流速の変化と侵食作用について",
                correct: "Because of the narrow paths, velocity will increase and tides become erosive forming a network of channels and bringing sediments back to the sea.",
                translation: "流路が狭くなるため流速が増し、潮汐流が侵食力を持つようになります。そして水路のネットワークを形成し、堆積物を海へと運び戻します。"
            },
            {
                id: 4,
                timeDisplay: "02:50 ～ 03:03",
                startSeconds: 170, // 2分50秒
                theme: "波が砕ける（breaking of a wave）際の高エネルギーなプロセスと堆積物の移動について",
                correct: "The breaking of a wave is a very high energy process, which mobilizes large amounts of sediments which are then transported and dumped in linear features along the coast as the water slows down coming then to a still stand.",
                translation: "波が砕ける現象は非常に高エネルギーなプロセスであり、大量の堆積物を巻き上げ（動き出させ）ます。その後、水流が減速して静止するにつれて、それらの堆積物は運搬され、海岸沿いに線状の地形として堆積します。"
            },
            {
                id: 5,
                timeDisplay: "04:04 ～ 04:10",
                startSeconds: 244, // 4分04秒
                theme: "沿岸流（longshore currents）の定義と作用について",
                correct: "These are called longshore currents, which can erode, transport or deposit sand along the coast.",
                translation: "これらは沿岸流と呼ばれ、海岸沿いに砂を侵食、運搬、あるいは堆積させることができます"
            }
        ];

        // HTML生成関数
        function renderQuiz() {
            const container = document.getElementById('quiz-container');
            container.innerHTML = ""; // 初期化

            quizData.forEach((q, index) => {
                // YouTubeの時間指定付きリンク
                const videoLink = `${BASE_URL}?t=${q.startSeconds}`;

                const html = `
                    <div class="question-card">
                        <div class="q-header">
                            <span class="q-title">第${q.id}問 (${q.timeDisplay})</span>
                            <a href="${videoLink}" target="_blank" class="play-link-btn">▶ YouTubeで再生</a>
                        </div>
                        <div class="theme-text">
                            <strong>テーマ:</strong> ${q.theme}
                        </div>
                        <div>
                            <textarea id="input-${index}" placeholder="ここに英語の文章を入力してください..."></textarea>
                        </div>
                        <div class="controls">
                            <button class="check-btn" onclick="checkAnswer(${index})">答え合わせ</button>
                            <span class="translation-toggle" onclick="toggleTrans(${index})">日本語訳を表示/非表示</span>
                        </div>
                        
                        <div id="result-${index}" class="result-area"></div>
                        <div id="trans-${index}" class="japanese-trans">
                            <strong>日本語訳:</strong><br>${q.translation}
                        </div>
                    </div>
                `;
                container.innerHTML += html;
            });
        }

        // 日本語訳の表示切替
        function toggleTrans(index) {
            const el = document.getElementById(`trans-${index}`);
            if (el) {
                el.style.display = (el.style.display === 'block') ? 'none' : 'block';
            }
        }

        // 判定ロジック
        function checkAnswer(index) {
            const inputEl = document.getElementById(`input-${index}`);
            const resultDiv = document.getElementById(`result-${index}`);
            
            if (!inputEl || !resultDiv) return;

            const userText = inputEl.value.trim();
            // 正解文の前後の空白も除去
            const correctText = quizData[index].correct.trim();

            if (!userText) {
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = '<span style="color:#c0392b;">テキストを入力してください。</span>';
                return;
            }

            // 完全一致の場合
            if (userText === correctText) {
                resultDiv.innerHTML = '<div class="perfect">正解です！ Perfect!</div>';
                resultDiv.style.display = 'block';
                return;
            }

            // 差分生成
            const html = "<strong>判定結果:</strong><br>" + generateDiffHTML(userText, correctText);
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = html;
        }

        // 差分HTML生成ロジック
        function generateDiffHTML(userStr, correctStr) {
            // 単語比較用にクリーニング（小文字化＆記号削除）
            const clean = s => s.toLowerCase().replace(/[.,?!;:"'’]/g, "");
            
            const userWords = userStr.split(/\s+/);
            const correctWords = correctStr.split(/\s+/);
            
            let output = "<div>";
            let uIndex = 0;
            
            for (let i = 0; i < correctWords.length; i++) {
                let cWord = correctWords[i];
                let cWordClean = clean(cWord);
                
                // ユーザー入力が先に終わってしまった場合（残りはすべて「不足」）
                if (uIndex >= userWords.length) {
                    output += `<span class="diff-word missing-word" title="正解: ${cWord}">${cWord}</span> `;
                    continue;
                }

                let uWord = userWords[uIndex];
                let uWordClean = clean(uWord);

                if (cWordClean === uWordClean) {
                    // 正解
                    output += `<span class="diff-word correct-word">${cWord}</span> `;
                    uIndex++;
                } else {
                    // 不一致の場合：
                    // 「次のユーザー単語」が「現在の正解」と一致するか確認（余分な単語が入ったパターン）
                    let nextUMatch = false;
                    if (uIndex + 1 < userWords.length) {
                         nextUMatch = (clean(userWords[uIndex+1]) === cWordClean);
                    }
                    
                    if (nextUMatch) {
                        // 現在のユーザー単語は「間違い（余分）」
                        output += `<span class="diff-word wrong-word">${uWord}</span> `;
                        // 次の正解単語を表示
                        output += `<span class="diff-word correct-word">${cWord}</span> `;
                        uIndex += 2; // ユーザー側のインデックスを2つ進める
                    } else {
                        // 単なる間違い、または単語が抜けている
                        output += `<span class="diff-word wrong-word">${uWord}</span> `;
                        output += `<span class="diff-word missing-word">${cWord}</span> `;
                        uIndex++;
                    }
                }
            }
            
            // ユーザー入力が余っている場合（最後につけたし過ぎた場合など）
            while(uIndex < userWords.length) {
                output += `<span class="diff-word wrong-word">${userWords[uIndex]}</span> `;
                uIndex++;
            }

            output += "</div>";
            output += "<div style='margin-top:10px; font-size:0.8em; color:#666;'>※ 緑：正解 / <span style='color:#c0392b; text-decoration:line-through;'>赤：間違い</span> / <span style='color:#2980b9; font-weight:bold; border-bottom: 2px solid #2980b9;'>青：不足していた正解</span></div>";
            
            return output;
        }

        // 初期化実行
        renderQuiz();

    </script>
</body>
</html>